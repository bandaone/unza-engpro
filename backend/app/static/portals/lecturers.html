<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lecturer Portal</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    header { padding: 12px 16px; border-bottom: 1px solid #eee; display: flex; gap: 12px; align-items: center; justify-content: space-between; }
    .container { padding: 12px 16px; max-width: 1000px; margin: 0 auto; }
    .toolbar { display: flex; gap: 8px; align-items: center; }
    .btn { padding: 8px 10px; background: #1976d2; color: white; border-radius: 6px; border: none; cursor: pointer; }
    .list { display: grid; gap: 10px; }
    .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
    .small { color: #555; font-size: 12px; }
    select, input { padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; }
    h3 { margin: 0; }
    .day { font-weight: 700; margin-top: 14px; }
    .empty { color: #777; font-style: italic; }
    nav a { margin-right: 10px; text-decoration: none; color: #1976d2; }
  </style>
</head>
<body>
  <header>
    <div>
      <h3>Timetable Portals — Lecturer</h3>
      <nav>
        <a href="/portals/groups.html">Groups</a>
        <a href="/portals/lecturers.html">Lecturers</a>
        <a href="/portals/rooms.html">Rooms</a>
        <a href="/">Admin</a>
      </nav>
    </div>
    <div class="toolbar">
      <select id="lectSelect"><option value="">-- Select Lecturer --</option></select>
      <button id="refreshBtn" class="btn">Refresh</button>
    </div>
  </header>
  <div class="container">
    <div id="info" class="small"></div>
    <div id="list" class="list"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script>
    const listEl = document.getElementById('list');
    const infoEl = document.getElementById('info');
    const lectSelect = document.getElementById('lectSelect');

    async function loadLecturers() {
      const res = await axios.get('/entities/lecturers');
      const items = res.data.sort((a,b)=> String(a.name).localeCompare(String(b.name)));
      lectSelect.innerHTML = '<option value="">-- Select Lecturer --</option>' + items.map(x => `<option value="${x.id}">${x.id}: ${x.name}${x.department?` (${x.department})`:''}</option>`).join('');
    }

    function groupByDay(events) {
      const order = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const map = {};
      for (const d of order) map[d] = [];
      for (const e of events) map[e.day]?.push(e);
      for (const d of order) map[d]?.sort((a,b)=> a.start.localeCompare(b.start));
      return map;
    }

    function render(events) {
      const byDay = groupByDay(events);
      const order = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      listEl.innerHTML = '';
      let total = 0;
      for (const d of order) {
        const items = byDay[d] || [];
        const section = document.createElement('div');
        section.className = 'card';
        const hdr = document.createElement('div');
        hdr.className = 'day';
        hdr.textContent = d;
        section.appendChild(hdr);
        if (!items.length) {
          const em = document.createElement('div'); em.textContent = 'No sessions'; em.className = 'empty'; section.appendChild(em);
        } else {
          for (const ev of items) {
            total++;
            const row = document.createElement('div');
            row.innerHTML = `${ev.start} - ${ev.end} • Course C${ev.course_id} • Group G${ev.group_id} • Room R${ev.room_id}`;
            section.appendChild(row);
          }
        }
        listEl.appendChild(section);
      }
      infoEl.textContent = `${total} sessions shown`;
    }

    async function refresh() {
      const id = parseInt(lectSelect.value||'0',10);
      if (!id) { infoEl.textContent = 'Select a lecturer'; listEl.innerHTML = ''; return; }
      const res = await axios.get(`/timetable/events?lecturer_id=${id}`);
      render(res.data || []);
    }

    document.getElementById('refreshBtn').addEventListener('click', refresh);
    lectSelect.addEventListener('change', refresh);

    (async function init(){ await loadLecturers(); })();
  </script>
</body>
</html>
